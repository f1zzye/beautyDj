{%  extends 'partials/base.html' %}
{% load static %}
{% block content %}


<div class="l-inner">
  <div class="woocommerce-notices-wrapper woocommerce-notices-wrapper--ajax" style="transform: translateY(0px);"></div>

  <div id="product-4592" class="c-product c-product--layout-1 l-section l-section--container product type-product post-4592 status-publish first instock product_cat-daeng-gi-meo-ri product_cat-brands product_cat-dlya_volossya product_cat-conditioner has-post-thumbnail sale shipping-taxable purchasable product-type-variable">

    <div class="c-product__wrap c-product__wrap--layout-1">
      <div class="c-product__col-1">
        <div class="js-sticky-sidebar-nearby">
          <div class="c-product__gallery">
<!--            <div class="c-badge__list c-product__badges"> <span class="c-badge c-badge&#45;&#45;sale">Розпродаж</span>-->
<!--            </div>-->
            <!-- .c-product__badges -->

            <div class="c-product__slider h-fade c-product__slider--carousel h-carousel h-carousel--inner h-carousel--hover h-carousel--dots-hide js-single-product-carousel">
              <div class="c-product__slider-item c-product__slider-item--zoom woocommerce-product-gallery__image " data-o_data-thumb="" data-thumb="">
                  <div data-img="{{ product.image.url }}" class="c-product__image-zoom js-product-zoom init" style="position: absolute; overflow: hidden;" data-o_data-img="https://www.onlyone.beauty/wp-content/uploads/2023/11/Daeng-Gi-Meo-Ri-Vitalizing-Treatment-500png.png"><img width="460" height="460" src="{{ product.image.url }}" class="c-product__slider-img c-product__slider-img--cover" alt="Daeng Gi Meo Ri Vitalizing Treatment 500png" decoding="async" srcset="{{ product.image.url }}" sizes="(max-width: 460px) 100vw, 460px" data-o_src="../../wp-content/uploads/2023/11/Daeng-Gi-Meo-Ri-Vitalizing-Treatment-500png-460x460.png" data-o_height="460" data-o_width="460" data-o_srcset="../../wp-content/uploads/2023/11/Daeng-Gi-Meo-Ri-Vitalizing-Treatment-500png-460x460.png 460w, ../../wp-content/uploads/2023/11/Daeng-Gi-Meo-Ri-Vitalizing-Treatment-500png-115x115.png 115w, ../../wp-content/uploads/2023/11/Daeng-Gi-Meo-Ri-Vitalizing-Treatment-500png-760x760.png 760w, ../../wp-content/uploads/2023/11/Daeng-Gi-Meo-Ri-Vitalizing-Treatment-500png-920x920.png 920w, ../../wp-content/uploads/2023/11/Daeng-Gi-Meo-Ri-Vitalizing-Treatment-500png-145x145.png 145w, ../../wp-content/uploads/2023/11/Daeng-Gi-Meo-Ri-Vitalizing-Treatment-500png-290x290.png 290w, ../../wp-content/uploads/2023/11/Daeng-Gi-Meo-Ri-Vitalizing-Treatment-500png-260x260.png 260w, ../../wp-content/uploads/2023/11/Daeng-Gi-Meo-Ri-Vitalizing-Treatment-500png.png 1000w" data-o_sizes="(max-width: 460px) 100vw, 460px" data-o_title="" title="" data-o_alt="Daeng Gi Meo Ri Vitalizing Treatment 500png" data-o_data-src="" data-src="" data-o_data-large_image="" data-large_image="" data-o_data-large_image_width="" data-large_image_width="" data-o_data-large_image_height="" data-large_image_height=""><img role="presentation" alt="" src="https://www.onlyone.beauty/wp-content/uploads/2023/11/Daeng-Gi-Meo-Ri-Vitalizing-Treatment-500png.png" class="zoomImg" style="position: absolute; top: -548.443px; left: -17.0217px; opacity: 0; width: 1000px; height: 1000px; border: medium; max-width: none; max-height: none;"></div><span class="c-product__loading"></span></a>
                <button class="h-cb c-product__image-zoom-mobile js-mobile-modal"><i class="ip-zoom"></i></button>
              </div>
            </div>

          </div>
          <!-- .c-product__gallery -->
          <div class="c-product__tabs woocommerce-tabs wc-tabs-wrapper  c-product__tabs--desktop">
            <div class="c-product__tabs-wrap">
              <ul class="c-product__tabs-list tabs wc-tabs js-tabs-list h-carousel h-carousel-small h-carousel--hover h-carousel--dots-hide" role="tablist">
                <li class="c-product__tabs-item description_tab active" id="tab-title-description" role="tab" aria-controls="tab-description">
                  <a data-index="0" class="c-product__tabs-item-link js-tabs-item-link" href="#tab-description">Опис</a>
                </li>
                <li class="c-product__tabs-item additional_information_tab" id="tab-title-additional_information" role="tab" aria-controls="tab-additional_information">
                  <a data-index="1" class="c-product__tabs-item-link js-tabs-item-link" href="#tab-additional_information">Додаткова інформація</a>
                </li>
              </ul>
            </div>
            <div class="c-product__tabs-panel woocommerce-Tabs-panel woocommerce-Tabs-panel--description panel entry-content wc-tab  current visible" id="tab-description" role="tabpanel" aria-labelledby="tab-title-description" style="">
                <strong>Опис продукту:</strong>
                    <p>{{ product.description }}</p>
              <strong>Спосіб використання:</strong>
                    <p>{{ product.usage }}</p>

            </div>
            <div class="c-product__tabs-panel woocommerce-Tabs-panel woocommerce-Tabs-panel--additional_information panel  wc-tab " id="tab-additional_information" role="tabpanel" aria-labelledby="tab-title-additional_information" style="display: none;">

              <table class="woocommerce-product-attributes shop_attributes">
                <tbody>
<!--                  <tr class="woocommerce-product-attributes-item woocommerce-product-attributes-item&#45;&#45;attribute_pa_%d0%b1%d1%80%d0%b5%d0%bd%d0%b4">-->
<!--                    <th class="woocommerce-product-attributes-item__label">Спосіб використання</th>-->
<!--                    <td class="woocommerce-product-attributes-item__value">-->
<!--                      <p><a rel="tag">{{ product.usage }}</a></p>-->
<!--                    </td>-->
<!--                  </tr>-->
                  <tr class="woocommerce-product-attributes-item woocommerce-product-attributes-item--attribute_pa_%d0%be%d0%b1%d1%94%d0%bc">
                    <th class="woocommerce-product-attributes-item__label">Бренд</th>
                    <td class="woocommerce-product-attributes-item__value">
                      <p><a href="" rel="tag">{{ product.brand }}</a></p>
                    </td>
                  </tr>
                  <tr class="woocommerce-product-attributes-item woocommerce-product-attributes-item--attribute_pa_%d0%be%d0%b1%d1%94%d0%bc">
                      <th class="woocommerce-product-attributes-item__label">Країна</th>
                      <td class="woocommerce-product-attributes-item__value">
                        <p><a rel="tag">{{ product.country_of_manufacture }}</a></p>
                      </td>
                    </tr>
                  <tr class="woocommerce-product-attributes-item woocommerce-product-attributes-item--attribute_pa_%d0%be%d0%b1%d1%94%d0%bc">
                      <th class="woocommerce-product-attributes-item__label">Тип шкіри/волосся</th>
                      <td class="woocommerce-product-attributes-item__value">
                        <p><a rel="tag">{{ product.skin_type }}</a></p>
                      </td>
                  </tr>
                  </tbody>
              </table>

            </div>

          </div>
        </div>

        <!-- .c-product__col-1 -->
      </div>
      <!-- .js-sticky-sidebar-nearby -->
      <div class="c-product__col-2">
        <div class="js-sticky-sidebar">
            <div class="summary entry-summary">
                <h1 class="c-product__title">{{ product.title }}</h1>
                <div class="c-product__short-description">
                    <p>{{ product.mini_description }}</p>
                </div>
                {% if product.old_price > product.price %}
                    <p class="price">
                        <del aria-hidden="true">
                            <span class="woocommerce-Price-amount amount">
                                <bdi>
                                    <span class="woocommerce-Price-currencySymbol">₴</span>
                                    {{ product.old_price }}
                                </bdi>
                            </span>
                        </del>
                        <ins>
                            <span class="woocommerce-Price-amount amount">
                                <bdi>
                                    <span class="woocommerce-Price-currencySymbol">₴</span>
                                    <span class="current-product-price-{{ product.id }}">{{ product.price }}</span>
                                </bdi>
                            </span>
                        </ins>
                    </p>
                {% else %}
                    <p class="price">
                        <span class="woocommerce-Price-amount amount">
                            <bdi>
                                <span class="woocommerce-Price-currencySymbol">&#8372;</span>
                                <span class="current-product-price-{{ product.id }}">{{ product.price }}</span>
                            </bdi>
                        </span>
                    </p>
                {% endif %}
                <div class="c-product__atc-wrap c-product__atc-wrap--hide-stock">
                    <form class="variations_form cart th-var-active init">
                        <table class="variations" cellspacing="0" role="presentation">
                            <tbody>
                                <tr>
                                    {% if product.volume or variants %}
                                        <th class="label">
                                            <label>Об`єм:</label>
                                        </th>
                                        <td class="value">
                                            <div class="thwvsf_fields">
                                                <select id="pa_%d0%be%d0%b1%d1%94%d0%bc"
                                                        class="thwvs-select"
                                                        name="attribute_pa_%d0%be%d0%b1%d1%94%d0%bc"
                                                        data-attribute_name="attribute_pa_%d0%be%d0%b1%d1%94%d0%bc"
                                                        data-design_type="swatch_design_1"
                                                        style="display:none"
                                                        data-show_option_none="yes">
                                                    <option value="">Виберіть опцію</option>
                                                    {% for volume_item in all_volumes %}
                                                    <option value="{{ volume_item.volume }}-мл" class="attached enabled">{{ volume_item.volume }} мл</option>
                                                    {% endfor %}
                                                </select>

                                                <ul class="thwvsf-wrapper-ul">
                                                    {% for volume_item in all_volumes %}
                                                    <li class="thwvsf-wrapper-item-li thwvsf-label-li thwvsf-div thwvsf-checkbox {% if volume_item.is_base %}active{% endif %}"
                                                        data-volume="{{ volume_item.volume }}"
                                                        data-price="{{ volume_item.price }}"
                                                        data-image="{{ volume_item.image_url }}"
                                                        {% if volume_item.is_base %}data-is-base="true"{% endif %}
                                                        {% if not volume_item.is_base %}data-variation-id="{{ volume_item.id }}"{% endif %}
                                                        {% if volume_item.old_price %}data-old-price="{{ volume_item.old_price }}"{% endif %}>
                                                        <span class="thwvsf-item-span item-span-text">{{ volume_item.volume }} мл</span>
                                                    </li>
                                                    {% endfor %}
                                                </ul>
                                            </div>
                                            <a class="reset_variations" href="#" style="visibility: hidden;">Очистити</a>
                                        </td>
                                    {% endif %}
                                </tr>
                            </tbody>
                        </table>

                <div class="single_variation_wrap">
                  <div class="woocommerce-variation single_variation" style="display: none;">
                    <div class="woocommerce-variation-description"></div>
                  </div>
                  <div class="woocommerce-variation-add-to-cart variations_button woocommerce-variation-add-to-cart-disabled">

                    <div class="c-product__quantity quantity">
                      <label class="screen-reader-text">Daeng Gi Meo Ri Vitalizing Treatment Кондиціонер регенеруючий інтенсивний кількість</label>
                      <input type="number" id="product-quantity"  class="c-product__quantity-value qty product-quantity-{{ product.id }}" min="1" value="1">
                      <button class="h-cb c-product__quantity-minus js-quantity-minus" type="button"><i class="ip-minus"></i></button>
                      <button class="h-cb c-product__quantity-plus js-quantity-plus" type="button"><i class="ip-plus_big"></i></button>
                    </div>

                        <input type="hidden" class="product-pid-{{ product.id }}" value="{{ product.pid }}">
                        <input type="hidden" class="product-image-{{  product.id }}" value="{{ product.image.url }}">
                        <input type="hidden" class="product-id-{{ product.id }}" value="{{ product.id }}">
                        <input type="hidden" class="product-title-{{ product.id }}" value="{{ product.title }}">
                        <input type="hidden" class="product-category" value="{{ product.category }}">

                        <button type="button" class="single_add_to_cart_button add-to-cart-btn button alt wc-variation-selection-needed" id="add-to-cart-btn" data-index="{{ product.id }}">Додати в кошик</button>
                  </div>
                </div>

              </form>

            </div>

            <!-- .c-product__atc-wra -->
            <div class="c-product__wishlist">
              <button class="js-wishlist-btn c-wishlist__btn c-wishlist__item-4592-btn h-cb c-product__wishlist-button" data-product-id="4592" data-title="Wishlist"><i class="ip-heart c-product__wishlist-icon c-wishlist__btn-icon c-wishlist__btn-icon-normal"></i><i class="ip-heart_hover c-product__wishlist-icon c-wishlist__btn-icon c-wishlist__btn-icon--hover"></i><span class="c-product__wishlist-text c-wishlist__btn-text-add">Add to Wishlist</span><span class="c-product__wishlist-text c-wishlist__btn-text-remove">Remove from Wishlist</span></button>
            </div>
            <div class="product_meta">

<!--              <span class="sku_wrapper">Артикул: <span class="sku">Невідомо</span></span>-->

<!--              <span class="posted_in">Категорії: <a href="../../product-category/brands/daeng-gi-meo-ri/index.htm" rel="tag">Daeng Gi Meo Ri</a>, <a href="../../product-category/brands/index.htm" rel="tag">Бренди</a>, <a href="../../product-category/dlya_volossya/index.htm" rel="tag">Для волосся</a>, <a href="../../product-category/dlya_volossya/conditioner/index.htm" rel="tag">Кондиціонери</a></span>-->

            </div>
          </div>

        </div>
        <!-- .c-product__col-2 -->
      </div>
<!--      <div class="c-product__tabs woocommerce-tabs wc-tabs-wrapper c-product__tabs&#45;&#45;mobile">-->
<!--        <div class="c-product__tabs-wrap">-->
<!--          <ul class="c-product__tabs-list tabs wc-tabs js-tabs-list h-carousel h-carousel-small h-carousel&#45;&#45;hover h-carousel&#45;&#45;dots-hide owl-carousel owl-loaded owl-drag" role="tablist">-->

<!--            <div class="owl-stage-outer">-->
<!--              <div class="owl-stage" style="transform: translate3d(0px, 0px, 0px); transition: all;">-->
<!--                <div class="owl-item">-->
<!--                  <li class="c-product__tabs-item description_tab active" id="tab-title-description" role="tab" aria-controls="tab-description">-->
<!--                    <a data-index="0" class="c-product__tabs-item-link js-tabs-item-link" href="#tab-description">Опис</a>-->
<!--                  </li>-->
<!--                </div>-->
<!--                <div class="owl-item">-->
<!--                  <li class="c-product__tabs-item additional_information_tab" id="tab-title-additional_information" role="tab" aria-controls="tab-additional_information">-->
<!--                    <a data-index="1" class="c-product__tabs-item-link js-tabs-item-link" href="#tab-additional_information">Додаткова інформація</a>-->
<!--                  </li>-->
<!--                </div>-->
<!--              </div>-->
<!--            </div>-->
<!--            <div class="owl-nav disabled">-->
<!--              <button type="button" role="presentation" class="owl-prev disabled"><i class="ip-right h-carousel__prev"></i></button>-->
<!--              <button type="button" role="presentation" class="owl-next"><i class="ip-right h-carousel__next"></i></button>-->
<!--            </div>-->
<!--            <div class="owl-dots disabled"></div>-->
<!--          </ul>-->
<!--        </div>-->
<!--        <div class="c-product__tabs-panel woocommerce-Tabs-panel woocommerce-Tabs-panel&#45;&#45;description panel entry-content wc-tab  current visible" id="tab-description" role="tabpanel" aria-labelledby="tab-title-description" style="">-->

<!--          <p>{{ product.description }}</p>-->
<!--        </div>-->
<!--        <div class="c-product__tabs-panel woocommerce-Tabs-panel woocommerce-Tabs-panel&#45;&#45;additional_information panel  wc-tab " id="tab-additional_information" role="tabpanel" aria-labelledby="tab-title-additional_information" style="display: none;">-->

<!--          <table class="woocommerce-product-attributes shop_attributes">-->
<!--            <tbody>-->
<!--              <tr class="woocommerce-product-attributes-item woocommerce-product-attributes-item&#45;&#45;attribute_pa_%d0%b1%d1%80%d0%b5%d0%bd%d0%b4">-->
<!--                <th class="woocommerce-product-attributes-item__label">Бренд</th>-->
<!--                <td class="woocommerce-product-attributes-item__value">-->
<!--                  <p><a href="../../%D0%B1%D1%80%D0%B5%D0%BD%D0%B4/daeng-gi-meo-ri/index.htm" rel="tag">Daeng Gi Meo Ri</a></p>-->
<!--                </td>-->
<!--              </tr>-->
<!--              <tr class="woocommerce-product-attributes-item woocommerce-product-attributes-item&#45;&#45;attribute_pa_%d0%be%d0%b1%d1%94%d0%bc">-->
<!--                <th class="woocommerce-product-attributes-item__label">Об`єм</th>-->
<!--                <td class="woocommerce-product-attributes-item__value">-->
<!--                  <p><a href="../../%D0%BE%D0%B1%D1%94%D0%BC/300-%D0%BC%D0%BB/index.htm" rel="tag">300 мл</a>, <a href="../../%D0%BE%D0%B1%D1%94%D0%BC/500-%D0%BC%D0%BB/index.htm" rel="tag">500 мл</a></p>-->
<!--                </td>-->
<!--              </tr>-->
<!--            </tbody>-->
<!--          </table>-->

<!--        </div>-->

<!--      </div>-->


    </div>
    <!-- .c-product__wrap -->
    <section class="elementor-section elementor-top-section elementor-element elementor-section-boxed elementor-section-height-default">
        <div class="elementor-container elementor-column-gap-default">
            <div class="elementor-column elementor-col-100 elementor-top-column elementor-element">
                <div class="elementor-widget-wrap elementor-element-populated">
                    <div class="elementor-element elementor-widget elementor-widget-ideapark-woocommerce-carousel">
                        <div class="elementor-widget-container">
                            <div class="c-ip-woocommerce-carousel">
                                <div class="c-ip-woocommerce-carousel__wrap">
                                    <div class="woocommerce columns-4">
                                        <div class="c-product__products-title">Схожі товари</div>
                                        <div class="c-product-grid__wrap c-product-grid__wrap--4-per-row c-product-grid__wrap--2-per-row">
                                            <div data-autoplay="yes" data-animation-timeout="5000" class="c-product-grid__list c-ip-woocommerce-carousel__list c-ip-woocommerce-carousel__list--4-per-row js-woocommerce-carousel h-carousel h-carousel--default-dots h-carousel--flex h-carousel--round h-carousel--border c-ip-woocommerce-carousel__list--dots">
                                                {% for product in products %}
                                                    <div class="c-product-grid__item c-product-grid__item--sidebar c-product-grid__item--4-per-row c-product-grid__item--normal c-product-grid__item--always c-product-grid__item--2-per-row product type-product">
                                                        {% if product.old_price > product.price %}
                                                            <div class="c-product-grid__badges c-badge__list">
                                                                <span class="c-badge c-badge--sale">-{{ product.get_percentage|floatformat:1 }}%</span>
                                                            </div>
                                                        {% endif %}
                                                        <div class="c-product-grid__thumb-wrap c-product-grid__thumb-wrap--buttons">
                                                            <a href="{% url 'core:product-detail' product.pid %}" class="woocommerce-LoopProduct-link woocommerce-loop-product__link">
                                                                <span class="acoplw-badge">
                                                                    <img width="260" height="260"
                                                                         src="{{ product.image.url }}"
                                                                         class="c-product-grid__thumb c-product-grid__thumb--cover"
                                                                         alt=""
                                                                         decoding="async">
                                                                </span>
                                                            </a>
                                                            <div class="c-product-grid__thumb-button-list">
                                                                <button class="js-wishlist-btn c-wishlist__btn h-cb c-product-grid__thumb-button"
                                                                        data-product-id="{{ product.id }}"
                                                                        data-title="Wishlist">
                                                                    <i class="ip-heart c-product-grid__icon c-product-grid__icon--wishlist c-wishlist__btn-icon c-wishlist__btn-icon-normal"></i>
                                                                    <i class="ip-heart_hover c-product-grid__icon c-product-grid__icon--wishlist c-wishlist__btn-icon c-wishlist__btn-icon--hover"></i>
                                                                </button>
                                                            </div>
                                                        </div>

                                                        <a data-quantity="1" class="h-cb c-product-grid__atc button product_type_variable add-to-cart-btn"
                                                           data-index="{{ product.id }}" rel="nofollow">
                                                            <input type="hidden" value="1" class="product-quantity-{{ product.id }}">
                                                            <input type="hidden" class="product-pid-{{ product.id }}" value="{{ product.pid }}">
                                                            <input type="hidden" class="product-image-{{ product.id }}" value="{{ product.image.url }}">
                                                            <input type="hidden" class="product-id-{{ product.id }}" value="{{ product.id }}">
                                                            <input type="hidden" class="product-title-{{ product.id }}" value="{{ product.title }}">
                                                            <i class="ip-cart c-product-grid__atc-icon"></i>
                                                        </a>

                                                        <div class="c-product-grid__details">
                                                            <div class="c-product-grid__title-wrap">
                                                                <a href="{% url 'core:product-detail' product.pid %}" class="woocommerce-LoopProduct-link woocommerce-loop-product__link">
                                                                    <h2 class="woocommerce-loop-product__title">{{ product.title }}</h2>
                                                                </a>
                                                                <a href="{% url 'core:product-detail' product.pid %}" class="woocommerce-LoopProduct-link woocommerce-loop-product__link">
                                                                    <div class="c-product-grid__short-desc">
                                                                        <p>{{ product.brand }}</p>
                                                                    </div>
                                                                </a>
                                                            </div>

                                                            <!-- Блок с ценой -->
                                                            <div class="c-product-grid__price-wrap">
    <span class="price">
        {% if product.old_price > product.price %}
            <del aria-hidden="true">
                <span class="woocommerce-Price-amount amount">
                    <bdi>
                        <span class="woocommerce-Price-currencySymbol">&#8372;</span>
                        {{ product.old_price }}
                    </bdi>
                </span>
            </del>
            <ins>
                <span class="woocommerce-Price-amount amount">
                    <bdi>
                        <span class="woocommerce-Price-currencySymbol">&#8372;</span>
                        <span class="current-product-price-{{ product.id }}">{{ product.price }}</span>
                    </bdi>
                </span>
            </ins>
        {% else %}
            <span class="woocommerce-Price-amount amount">
                <bdi>
                    <span class="woocommerce-Price-currencySymbol">&#8372;</span>
                    <span class="current-product-price-{{ product.id }}">{{ product.price }}</span>
                </bdi>
            </span>
        {% endif %}
    </span>
</div>
                                                        </div>
                                                    </div>
                                                {% endfor %}
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

  </div>
    <script>
    document.addEventListener('DOMContentLoaded', function() {
        const tabs = document.querySelectorAll('.c-product__tabs-item-link');
        const tabContents = document.querySelectorAll('.wc-tab');

        function switchTab(event) {
            event.preventDefault();


            tabs.forEach(tab => tab.parentElement.classList.remove('active'));
            tabContents.forEach(content => {
                content.style.display = 'none';
                content.classList.remove('current', 'visible');
            });

            const targetTab = document.querySelector(this.getAttribute('href'));
            console.log(this.parentElement);
            this.parentElement.classList.add('active');
            targetTab.style.display = '';
            targetTab.classList.add('current', 'visible');
        }

        tabs.forEach(tab => {
            tab.addEventListener('click', switchTab);
            console.log(tab);
        });
    });
      </script>

    <script>
        (function($) {
            $(document).ready(function() {
                const mainImageElement = $('.c-product__slider-img');
                const zoomContainer = $('.c-product__image-zoom');
                const priceDisplay = $('.price');
                const downloadLink = $('.c-product__image-link');
                const addToCartBtn = $('.add-to-cart-btn');
                const mainSlider = $('.c-product__slider'); // Main slider container
                const thumbnailSlider = $('.c-product__thumbs'); // Thumbnail slider if exists
                let currentVariationData = null;

                // Update all product images
                function updateAllImages(imageUrl) {
                    if (!imageUrl) return;

                    // Update main image
                    mainImageElement.attr('src', imageUrl).attr('srcset', imageUrl);

                    // Update zoom container
                    zoomContainer.attr('data-img', imageUrl);
                    downloadLink.attr('href', imageUrl);

                    // Update owl carousel slide if it exists
                    if (mainSlider.hasClass('owl-carousel')) {
                        // Remove existing slides
                        mainSlider.trigger('destroy.owl.carousel');
                        mainSlider.html(`
                            <div class="c-product__slider-item">
                                <img src="${imageUrl}"
                                     class="c-product__slider-img"
                                     alt="Product Image">
                            </div>
                        `);
                        // Reinitialize the carousel
                        mainSlider.owlCarousel({
                            items: 1,
                            nav: true,
                            dots: false,
                            loop: false,
                            rtl: ideapark_is_rtl,
                            navText: ideapark_nav_text,
                        });
                    }

                    // Update thumbnail if it exists
                    if (thumbnailSlider.length) {
                        thumbnailSlider.find('.c-product__thumbs-item.active')
                            .find('img')
                            .attr('src', imageUrl);
                    }

                    // Reset and reinitialize zoom
                    $('.zoomImg').remove();
                    zoomContainer.zoom({
                        url: imageUrl,
                        touch: false,
                        onZoomIn: function() {
                            $(this).addClass('active');
                        },
                        onZoomOut: function() {
                            $(this).removeClass('active');
                        }
                    });

                    // Update hidden input for cart
                    $('.product-image-' + addToCartBtn.attr('data-index')).val(imageUrl);
                }

                function updatePrice(price, oldPrice) {
                    if (!price) return;

                    const mainProductPrice = $('.summary.entry-summary .price');
                    const productId = addToCartBtn.attr('data-index');

                    if (oldPrice && parseFloat(oldPrice) > parseFloat(price)) {
                        mainProductPrice.html(`
                            <del aria-hidden="true">
                                <span class="woocommerce-Price-amount amount">
                                    <bdi><span class="woocommerce-Price-currencySymbol">₴</span>${oldPrice}</bdi>
                                </span>
                            </del>
                            <ins>
                                <span class="woocommerce-Price-amount amount">
                                    <bdi><span class="woocommerce-Price-currencySymbol">₴</span>
                                        <span class="current-product-price-${productId}">${price}</span>
                                    </bdi>
                                </span>
                            </ins>
                        `);
                    } else {
                        mainProductPrice.html(`
                            <span class="woocommerce-Price-amount amount">
                                <bdi><span class="woocommerce-Price-currencySymbol">₴</span>
                                    <span class="current-product-price-${productId}">${price}</span>
                                </bdi>
                            </span>
                        `);
                    }

                    const currentPriceSpans = mainProductPrice.find(`.current-product-price-${productId}`);
                    if (currentPriceSpans.length > 1) {
                        currentPriceSpans.not(':first').remove();
                    }
                }

                $('.thwvsf-wrapper-item-li').on('click', function(e) {
                    e.preventDefault();
                    const $this = $(this);

                    if ($this.hasClass('active')) {
                        // Reset to base variation
                        $('.thwvsf-wrapper-item-li').removeClass('active');
                        const baseElement = $('[data-is-base="true"]');
                        baseElement.addClass('active');
                        currentVariationData = null;
                        $('.variation_id').val('');

                        // Reset to base values
                        updatePrice(baseElement.data('price'));
                        updateAllImages(baseElement.data('image'));
                    } else {
                        // Set new variation
                        $('.thwvsf-wrapper-item-li').removeClass('active');
                        $this.addClass('active');

                        // Store current variation data
                        currentVariationData = {
                            variation_id: $this.data('variation-id'),
                            price: $this.data('price'),
                            old_price: $this.data('old-price'),
                            image: $this.data('image'),
                            volume: $this.data('volume')
                        };

                        // Update display
                        updatePrice(currentVariationData.price, currentVariationData.old_price);
                        updateAllImages(currentVariationData.image);
                        $('.variation_id').val(currentVariationData.variation_id);
                    }
                });

                // Handle add to cart
                $(document).on('click', '.add-to-cart-btn', function(e) {
                    e.preventDefault();

                    const this_val = $(this);
                    const index_val = this_val.attr('data-index');
                    const isProductPage = this_val.hasClass('single_add_to_cart_button');

                    // Get product data
                    const quantity = $('.product-quantity-' + index_val).val();
                    const product_title = $('.product-title-' + index_val).val();
                    const product_id = $('.product-id-' + index_val).val();
                    const product_pid = $('.product-pid-' + index_val).val();
                    const product_image = currentVariationData ? currentVariationData.image : $('.product-image-' + index_val).val();
                    const product_price = currentVariationData ? currentVariationData.price : $('.current-product-price-' + index_val).text();

                    // Validate variation selection
                    if (isProductPage && $('.thwvsf-wrapper-item-li').length && !currentVariationData && !$('[data-is-base="true"]').hasClass('active')) {
                        alert('Будь ласка, виберіть об\'єм продукту');
                        return;
                    }

                    // Add to cart AJAX request
                    $.ajax({
                        url: '/add-to-cart',
                        data: {
                            'id': product_id,
                            'pid': product_pid,
                            'image': product_image,
                            'quantity': quantity,
                            'title': product_title,
                            'price': product_price,
                            'variation_id': currentVariationData ? currentVariationData.variation_id : '',
                            'volume': currentVariationData ? currentVariationData.volume : ''
                        },
                        dataType: 'json',
                        beforeSend: function() {
                            this_val.prop('disabled', true);
                        },
                        success: function(response) {
                            if (isProductPage) {
                                this_val.html('Товар у кошику');
                            } else {
                                this_val.html('<span class="success-check">✔</span>');
                            }
                            this_val.addClass('added-to-cart');
                            $('.cart-items-count').text(response.totalcartitems);
                        },
                        error: function(xhr, status, error) {
                            console.error('Error adding to cart:', error);
                            this_val.prop('disabled', false);
                            alert('Помилка при додаванні товару до кошика. Будь ласка, спробуйте ще раз.');
                        },
                        complete: function() {
                            this_val.prop('disabled', false);
                        }
                    });
                });

                handleQuantityChange();

                if (zoomContainer.length) {
                    zoomContainer.zoom({
                        url: zoomContainer.data('img'),
                        touch: false,
                        onZoomIn: function() {
                            $(this).addClass('active');
                        },
                        onZoomOut: function() {
                            $(this).removeClass('active');
                        }
                    });
                }
            });
        })(jQuery);
    </script>
</div>

{% endblock %}